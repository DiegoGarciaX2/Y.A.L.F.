#include <Wire.h>       //biblioteca wire para el sensor de lineas
#define uchar unsigned char
uchar t;
//void send_data(short a1,short b1,short c1,short d1,short e1,short f1);
uchar data[16];

void setup()
{
  Wire.begin();        // join i2c bus (address optional for master)
  Serial.begin(9600);  // start serial for output
  pinMode(11, OUTPUT);    //int3 para el motor driver
  pinMode(6, OUTPUT);     //int1 para el motor driver
  t = 0;
}
void loop()
{
  int sensor[8];
  int x=0;
  int VMd;    //voltage for right motor
  int VMi;    //voltage for left motor
  Wire.requestFrom(9, 16);    // request 16 bytes from slave device #9
  while (Wire.available())   // slave may send less than requested
  {
    data[t] = Wire.read(); // receive a byte as character
    data[t]=(data[t]>70)?1:0;
    if(t%2==0){
      sensor[x]=data[t];
      x++;
    }
    if (t < 15){
      t++;
    }
    else{
      t = 0;
      x = 0;
    }
  }
  Serial.print("Sensor: ");
  for(x=0; x<8; x++){
    Serial.print(" ");
    Serial.print(sensor[x]);
  }
  Serial.println();
  int k=kvalue(sensor);
  Serial.print("k:");
  Serial.print(k);
  Serial.println();
  delay(2000);
  VMd=MotorD(k);
  VMi=MotorI(k);  
  digitalWrite(6,VMd);    //NO se Sabe si es derecha!!!
  digitalWrite(11,VMi);   //lo mismo...
}

int kvalue(int sensor[]){
  int control=0;
  int k=0;
  for(int x=0; x<=3 && control==0; x++){
    if(sensor[x]==0){
      control=1;
      k=x-3;
    }
  }
  for(int x=7; x>=4 && control==0; x--){
    if(sensor[x]==0){
      control=1;
      k=x-4;
    }
  }
  return k;
}
int MotorI(int Ki){           //calcula el vaolr entre zero y 127,5 que va al motor izquierdo
  int voltagei=Ki*(127,5/4)*(-1);
  return voltagei;
}
int MotorD(int Kd){           //calcula el vaolr entre zero y 127,5 que va al motor derecho
  int voltaged=Kd*(127,5/4);
  return voltaged;
}
